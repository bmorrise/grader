image: maven:3.3-jdk-8

variables:
  FRONTEND_CONTAINER_IMAGE: bmorrise/frontend:${CI_BUILD_REF_NAME}_${CI_BUILD_REF}
  FRONTEND_CONTAINER_IMAGE_LATEST: bmorrise/frontend:latest

  CONTAINER_IMAGE: bmorrise/${CI_PROJECT_NAME}:${CI_BUILD_REF_NAME}_${CI_BUILD_REF}
  CONTAINER_IMAGE_LATEST: bmorrise/${CI_PROJECT_NAME}:latest

stages:
  - build
  - build_image

build:
  stage: build
  script:
    - mvn clean install -DskipTests

build_image:
  stage: build_image
  image: docker:19
  before_script:
    - echo ${FRONTEND_CONTAINER_IMAGE}
    - echo -n $DOCKER_HUB_TOKEN | docker login -u bmorrise --password-stdin
  script:
    - cd frontend
    - docker build -t ${FRONTEND_CONTAINER_IMAGE} .
    - docker push ${FRONTEND_CONTAINER_IMAGE}